<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style type="text/css">
        /*html, body
        {
            height: 100%
        }*/
/*        #logo
        {
            width: 100px;
            height: 100px;
            position: relative;
            top: 30%;
            left:5%;

        }



        #video
        {
            position: relative;
            top: 5%;
            left: 5%;
        }*/

/*        #defaultCanvas0
        {
            position: relative;
            top: 5%;
            right: -5%;
        }*/

      /*  #webcam
        {
            position: relative;
        }

        #handcam
        {
            position: relative;
        }*/

        #video
        {
            transform: rotateY(180deg);
            -webkit-transform:rotateY(180deg); /* Safari and Chrome */
            -moz-transform:rotateY(180deg); /* Firefox */
        }

        .row
        {
            margin:20px;
        }

        #logo, #logotext
        {
            display: block;
          margin-left: auto;
          margin-right: auto;
        }
        .wrapper {
          position: absolute;
          top: 5px;
          left: 5px;
          width: 520px;
          border-radius: 4px;
          border: 1px solid black;
          background-color: white;
          overflow: hidden;
          text-align: center;
        }
        .children {
          width: 256px;
          float: left;
          margin: 0px auto;
          text-align: center;
        }
        #img_container {
          width: 100vw;
          height: 100vh;
          background-color: #383838;
          position: relative;

        }
        .frames {
          max-width: 100%;
          height: auto;
          max-height: 100%;
          display: block;
          margin: auto;
        }
        p {
          font-family: 'Avenir';
          font-weight: 700;
          font-size: 20px;
          color: black;
        }
        /*canvas {
          display: inline-block;
        }*/
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">






</head>
<body>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.dev.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <script src="https://docs.opencv.org/3.4.0/opencv.js"> </script>
    <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script> -->
    <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"></script> -->
    <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script> -->

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>

    <!-- <img id="logo" src="/logo" width="500" height="600"> -->


    <div id="img_container">
    <div class="wrapper">
        <!--<div class="row"> class="col-lg-6"-->
            <div class="children">
                <video id="video" width="256" height="192"></video>
                <p class="text-center" id ="webcam">Webcam View</p>
            </div>
            <div class="children" >
                <div id="jumbo"></div>
                <p class="text-center" id ="handcam">Single Hand Tracking</p>
            </div>
        <!--</div>-->

        <!-- <div class="row d-flex justify-content-center">
            <div class="d-flex justify-content-center">
                <div class="text-center" id="logotext">Powered by</div>
              <img class="mx-auto d-block" id="logo" src="/logo" width="10%" height="10%">
            </div>
        </div> -->

  </div>
  <canvas id="img_canvas" background="red"height="500" width="500"></canvas>
  <!--<img class="frames" src="img/hand_down.jpeg"/>-->
  </div>

<!--
    <div style="width: 30%; height:150px; float: left;">
        <video id="video"></video>
</div>
<div style="width: 65%; height:150px; float: right;">
    <div id="jumbo"></div>
</div> -->





<!-- <script src="./finger.js"></script> -->
<script src="./fingerGetData.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript">

  function scaleToFit(image){
    // get the scale
    var scale = Math.min(c.width / image.width, c.height / image.height);
    // get the top left position of the image
    var x = (c.width / 2) - (image.width / 2) * scale;
    var y = (c.height / 2) - (image.height / 2) * scale;
    ctx.drawImage(image, x, y, image.width * scale, image.height * scale);
  }


  function draw_img(url) {
    //console.log("Drawing");
    var image = new Image();
    image.onload = function() {
      ctx.clearRect(0,0,c.width, c.height);
      scaleToFit(image);
      //console.log("Image is loaded");
    };
    image.src = url;
  }


  var sfx = new Audio('sound/tightening_sound_effect.m4a');
  var end_sound = new Audio('sound/ding.m4a');

  var c;
  var ctx;
  var light_img_array = ['img/light_left.jpeg', 'img/light_right.jpeg', 'img/light_on.jpeg']
  window.onload = () => {
    var thediv = document.getElementById("img_container");
    c = document.getElementById("img_canvas");
    ctx = c.getContext('2d');

    function resize(){
      c.width = thediv.clientWidth;
      c.height= thediv.clientHeight;
    }
    //on page resize, call resize()
    window.addEventListener("resize", resize, false);

    //call resize() initially to set the canvas size correctly
    resize();

    console.log("Window loaded");
    draw_img(light_img_array[0]);    // draw initial image

    var count = 0; //count
    var thumb_on_left = true;//bool for checking whether motion left or right

    // don't run redrawing until model is set up
    setTimeout(function() {
      var repeat = setInterval(function(){
        var last_el = trainingData[trainingData.length-1];

        //Only for RIGHT HAND
        var num = (last_el["thumb4"][0]-last_el["palm"][0])
        //console.log(num)
        //console.log(thumb_on_left)
        if (count == 5) {
          end_sound.play();
          draw_img(light_img_array[2]);
          alert("Exercise completed");
          clearInterval(repeat);
        }
        else if (num>0 && thumb_on_left==false) {
          sfx.play();
          draw_img(light_img_array[0]);
          thumb_on_left = true;
        }
        else if (num<0 && thumb_on_left==true) {
          sfx.play();
          draw_img(light_img_array[1]);
          thumb_on_left = false;
          count++;
        }


      }, 500);
    }, 5000)

  }

  //console.log(trainingData["index1"]);


</script>






</body>
</html>
